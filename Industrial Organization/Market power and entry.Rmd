---
title: "Industrial organization: Market power and entry"
author: "Oriol Eixarch (0872954)"
date: "27/4/2022"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
local({r <- getOption("repos")
       r["CRAN"] <- 'http://cran.us.r-project.org'
       options(repos=r)})
library(haven)
doctors <- read_dta("C:/Users/Oriol/OneDrive/UNI/MASTER/Industrial Organization/Assignment III/doctors.dta")
install.packages("expss")
install.packages("fastDummies")
install.packages("sjlabelled")
install.packages("oglmx")
library(expss)
library(fastDummies)
library(sjlabelled)
library(oglmx)
```

## I

```{r}
summary(doctors)
```

```{r}
(cross_tpct(doctors,doc))
(cross_cases(doctors,doc))
```

```{r}
doctors$doc5=doctors$doc
doctors$doc5[doctors$doc5>4]<-5
```

We can observe that 48.1% of the cities have 5 or less physicians. Among those, the ones that have no physician at all account for 25%. On the other hand, among those having more than 5 physicians, more than half have 10 physicians.
The most important observation is that frequency 10 represents 34% of the sample, indicating a possible upper truncation.

## II

The model:
```{r}
model=doctors[,c(4,6,7,9,10,11,13,14)]
model$pop=log(model$pop)
```

$$ doc5 = \beta_{1}* wal + \beta_{2}* dens + \beta_{3}* for + \beta_{4}* age1 + \beta_{5}* age3 + \beta_{6}* inc + \beta_{7}* ln(pop) $$

* We expect the variables to take the following sign:

  + $WAL$ should be **negative** due to the fact that it seems to be the less developed region in Belgium.
  + $dens$ should be **negative**, the more scattered the population, the greater need for more than one physician.
  + $for$ Despite not being a rule, the main part of expatriates belong to low-income segments, their demand for health will be lower than nationals, it is expected to be **negative**.
  + $age1$ should be **positive** since this population segment is specially vulnerable, thus demand is likely to be higher in towns where there are many young infants.
  + $age1$ should be **positive** since this population segment is specially vulnerable, thus demand is likely to be higher in towns where there are many old people.
  + $inc$ richer populations tend to spend more and more frequently in health, thus it is expected to be **positive**.
  + $pop$ The greater the population, the larger the market and thus the demand, it is expected to be **positive**.
  
## III

```{r}
OLS<-lm(doc5 ~ WAL + dens + FOR + AGE1 + AGE3 + INC + pop, data = model)
summary(OLS)
```

Our weakest assumption was precisely the one that does not match the results, it is true that Wallonia may be perceived as a less developed area, yet its population may be more disperse and the health spending may differ from the rule. All our remaining predictions match the results.
Interestingly enough, age1 does not seem to have a significant effect on number of physicians.

## IV

```{r}
ordprb<-oprobit.reg(doc5 ~ WAL + dens + FOR + AGE1 + AGE3 + INC + pop, data = model)
summary(ordprb)
```

Probit indicates the same insignificance of age1, but also indicates an insignificance of density which is somewhat surprising as well as an insignificance of income at 5% significance level.
Apart from that, the only inconsistency regarding signs continues to be with wal (density as well but as aforementioned it is highly insignificant).


## V

Taking the means of all control variables:

```{r}
model$mwal = mean(model$WAL)
model$mdens = mean(model$dens)
model$mfor = mean(model$FOR)
model$mage1 = mean(model$AGE1)
model$mage3 = mean(model$AGE3)
model$minc = mean(model$INC)
model$mpop = mean(model$pop)
```

Extracting coefficients and transforming them to their non starred variants:

```{r}
model$sigma = 1/ordprb$coefficients[7]
model$b1 = ordprb$coefficients[1]*model$sigma
model$b2 = ordprb$coefficients[2]*model$sigma
model$b3 = ordprb$coefficients[3]*model$sigma
model$b4 = ordprb$coefficients[4]*model$sigma
model$b5 = ordprb$coefficients[5]*model$sigma
model$b6 = ordprb$coefficients[6]*model$sigma
model$d1 = ordprb$coefficients[8]*model$sigma
model$d2 = ordprb$coefficients[9]*model$sigma
model$d3 = ordprb$coefficients[10]*model$sigma
model$d4 = ordprb$coefficients[11]*model$sigma
model$d5 = ordprb$coefficients[12]*model$sigma
```

Entry threshold calculations:

```{r}
attach(model)
model$S1 = exp(-(b1*mwal + b2*mdens + b3*mfor + b4*mage1 + b5*mage3 + b6*minc) + d1)
model$S2 = exp(-(b1*mwal + b2*mdens + b3*mfor + b4*mage1 + b5*mage3 + b6*minc) + d2)
model$S3 = exp(-(b1 * mwal + b2*mdens + b3*mfor + b4*mage1 + b5*mage3 + b6*minc) + d3)
model$S4 = exp(-(b1*mwal + b2*mdens + b3*mfor + b4*mage1 + b5*mage3 + b6*minc) + d4)
model$S5 = exp(-(b1 * mwal + b2*mdens + b3*mfor + b4*mage1 + b5*mage3 + b6*minc ) + d5)
detach(model)
```

Entry threshold ratio calculations:

```{r}
model$ETR1 = (model$S2/2)/(model$S1/1)
model$ETR2 = (model$S3/3)/(model$S2/2)
model$ETR3 = (model$S4/4)/(model$S3/3)
model$ETR4 = (model$S5/5)/(model$S4/4)
```

```{r}
summary(model[,28:36])
```

The entry thresholds continue to rise with each additional added physician. The ratios provide some interesting results, since each entry of an additional physician has an almost neutral effect on their profits. The biggest shocks are observed going from 1 to 2 with a sizable negative effect and going from 4 to 5 with a positive effect. The last result can be attributed to the truncation of the data since we know that there exist a numerous amount of municipalities with a larger than 5 number of physicians and potentially larger than 10.

